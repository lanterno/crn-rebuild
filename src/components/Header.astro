---
interface Props {
  currentPath: string;
}

const { currentPath } = Astro.props;

const navigation = [
  { label: 'Home', href: '/' },
  { label: 'Consulting', href: '/consulting' },
  { label: 'Research', href: '/research' },
  { label: 'Summits', href: '/summits' },
  { label: 'Map', href: '/map' },
  { label: 'Slack', href: '/slack' },
];

function isActive(href: string, current: string): boolean {
  if (href === '/') return current === '/';
  return current.startsWith(href);
}
---

<header id="header" class="bg-white border-b border-gray-100 sticky top-0 z-50 transition-shadow duration-300">
  <nav class="container mx-auto px-4 py-4">
    <div class="flex items-center justify-between">
      <!-- Logo -->
      <a href="/" class="flex items-center gap-3 group">
        <img src="/images/crn-logo.png" alt="CRN Logo" class="w-10 h-10" />
        <span class="font-heading text-lg md:text-xl lg:text-2xl font-bold text-crn-blue tracking-wide uppercase">
          <span class="hidden sm:inline">The Climate Robotics Network</span>
          <span class="sm:hidden">CRN</span>
        </span>
      </a>
      
      <!-- Desktop Navigation -->
      <div class="hidden lg:flex items-center gap-8">
        {navigation.map((item) => (
          <a
            href={item.href}
            class={`relative py-2 text-sm font-semibold uppercase tracking-wider transition-colors ${
              isActive(item.href, currentPath) 
                ? 'text-crn-blue' 
                : 'text-gray-700 hover:text-crn-blue'
            }`}
          >
            {item.label}
            {isActive(item.href, currentPath) && (
              <span class="absolute bottom-0 left-0 w-full h-0.5 bg-crn-blue"></span>
            )}
          </a>
        ))}
      </div>
      
      <!-- Mobile Menu Button -->
      <button
        id="mobile-menu-btn"
        class="lg:hidden p-2 rounded-lg hover:bg-gray-100 transition-colors focus:outline-none focus:ring-2 focus:ring-crn-blue focus:ring-offset-2"
        aria-label="Toggle menu"
        aria-expanded="false"
        aria-controls="mobile-menu"
      >
        <!-- Hamburger Icon -->
        <svg id="menu-icon-open" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h16M4 18h16"
          />
        </svg>
        <!-- Close Icon (hidden by default) -->
        <svg id="menu-icon-close" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"
          />
        </svg>
      </button>
    </div>
    
    <!-- Mobile Navigation -->
    <div 
      id="mobile-menu" 
      class="lg:hidden overflow-hidden transition-all duration-300 ease-in-out"
      style="max-height: 0; opacity: 0;"
    >
      <div class="pt-4 pb-2 border-t border-gray-100 mt-4">
        <div class="flex flex-col gap-1">
          {navigation.map((item) => (
            <a
              href={item.href}
              class={`px-4 py-3 rounded-lg text-sm font-semibold uppercase tracking-wider transition-all ${
                isActive(item.href, currentPath) 
                  ? 'text-crn-blue bg-crn-blue/10' 
                  : 'text-gray-700 hover:text-crn-blue hover:bg-gray-50'
              }`}
            >
              {item.label}
            </a>
          ))}
        </div>
        
        {/* Mobile CTA */}
        <div class="mt-4 pt-4 border-t border-gray-100">
          <a 
            href="/slack"
            class="flex items-center justify-center gap-2 w-full px-4 py-3 bg-crn-green text-white font-semibold text-sm uppercase tracking-wider rounded-lg hover:bg-crn-green-dark transition-colors"
          >
            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
              <path d="M5.042 15.165a2.528 2.528 0 0 1-2.52 2.523A2.528 2.528 0 0 1 0 15.165a2.527 2.527 0 0 1 2.522-2.52h2.52v2.52zM6.313 15.165a2.527 2.527 0 0 1 2.521-2.52 2.527 2.527 0 0 1 2.521 2.52v6.313A2.528 2.528 0 0 1 8.834 24a2.528 2.528 0 0 1-2.521-2.522v-6.313z"/>
            </svg>
            Join Community
          </a>
        </div>
      </div>
    </div>
  </nav>
</header>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const menuBtn = document.getElementById('mobile-menu-btn');
    const mobileMenu = document.getElementById('mobile-menu');
    const iconOpen = document.getElementById('menu-icon-open');
    const iconClose = document.getElementById('menu-icon-close');
    const header = document.getElementById('header');
    
    // Mobile menu toggle
    menuBtn?.addEventListener('click', () => {
      const isExpanded = menuBtn.getAttribute('aria-expanded') === 'true';
      menuBtn.setAttribute('aria-expanded', String(!isExpanded));
      
      if (isExpanded) {
        // Close menu
        if (mobileMenu) {
          mobileMenu.style.maxHeight = '0';
          mobileMenu.style.opacity = '0';
        }
        iconOpen?.classList.remove('hidden');
        iconClose?.classList.add('hidden');
      } else {
        // Open menu
        if (mobileMenu) {
          mobileMenu.style.maxHeight = mobileMenu.scrollHeight + 'px';
          mobileMenu.style.opacity = '1';
        }
        iconOpen?.classList.add('hidden');
        iconClose?.classList.remove('hidden');
      }
    });
    
    // Close menu when clicking a link
    mobileMenu?.querySelectorAll('a').forEach(link => {
      link.addEventListener('click', () => {
        menuBtn?.setAttribute('aria-expanded', 'false');
        if (mobileMenu) {
          mobileMenu.style.maxHeight = '0';
          mobileMenu.style.opacity = '0';
        }
        iconOpen?.classList.remove('hidden');
        iconClose?.classList.add('hidden');
      });
    });
    
    // Add shadow on scroll
    let lastScrollY = 0;
    window.addEventListener('scroll', () => {
      const scrollY = window.scrollY;
      
      if (scrollY > 10) {
        header?.classList.add('shadow-md');
      } else {
        header?.classList.remove('shadow-md');
      }
      
      lastScrollY = scrollY;
    });
  });
</script>
