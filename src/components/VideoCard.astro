---
/**
 * VideoCard Component
 * Displays a YouTube video with thumbnail, title, duration, and play button.
 * Supports inline modal playback.
 */
import type { Video } from '@/lib/summits-data';
import { getYouTubeThumbnail, getYouTubeEmbedUrl } from '@/lib/summits-data';

interface Props {
  video: Video;
  compact?: boolean;
}

const { video, compact = false } = Astro.props;

const thumbnailUrl = getYouTubeThumbnail(video.youtubeId, 'high');
const embedUrl = getYouTubeEmbedUrl(video.youtubeId);

const typeColors = {
  keynote: 'bg-purple-500',
  panel: 'bg-crn-blue',
  talk: 'bg-teal-500',
  pitch: 'bg-orange-500',
  opening: 'bg-crn-green',
  closing: 'bg-gray-600',
};

const typeLabels = {
  keynote: 'Keynote',
  panel: 'Panel',
  talk: 'Talk',
  pitch: 'Pitches',
  opening: 'Opening',
  closing: 'Closing',
};
---

<div 
  class={`video-card group relative bg-white rounded-xl overflow-hidden shadow-md hover:shadow-xl transition-all duration-300 cursor-pointer ${compact ? '' : 'hover:-translate-y-1'}`}
  data-embed-url={embedUrl}
  data-video-title={video.title}
>
  {/* Thumbnail */}
  <div class={`relative ${compact ? 'aspect-video' : 'aspect-video'}`}>
    <img
      src={thumbnailUrl}
      alt={video.title}
      class="w-full h-full object-cover"
      loading="lazy"
    />
    
    {/* Play Button Overlay */}
    <div class="absolute inset-0 bg-black/30 group-hover:bg-black/50 transition-colors flex items-center justify-center">
      <div class="w-16 h-16 rounded-full bg-white/90 group-hover:bg-white group-hover:scale-110 transition-all flex items-center justify-center shadow-lg">
        <svg class="w-8 h-8 text-crn-blue ml-1" fill="currentColor" viewBox="0 0 24 24">
          <path d="M8 5v14l11-7z" />
        </svg>
      </div>
    </div>
    
    {/* Duration Badge */}
    <div class="absolute bottom-2 right-2 px-2 py-1 bg-black/80 text-white text-xs font-mono rounded">
      {video.duration}
    </div>
    
    {/* Type Badge */}
    <div class={`absolute top-2 left-2 px-2 py-1 ${typeColors[video.type]} text-white text-xs font-bold uppercase tracking-wide rounded`}>
      {typeLabels[video.type]}
    </div>
  </div>
  
  {/* Content */}
  <div class={`${compact ? 'p-3' : 'p-4'}`}>
    <h4 class={`font-heading font-semibold text-gray-900 ${compact ? 'text-sm line-clamp-2' : 'text-base line-clamp-2'} group-hover:text-crn-blue transition-colors`}>
      {video.title}
    </h4>
    
    {!compact && video.description && (
      <p class="text-gray-600 text-sm mt-2 line-clamp-2">
        {video.description}
      </p>
    )}
    
    {!compact && video.speakers && video.speakers.length > 0 && (
      <div class="mt-3 flex items-center gap-2 text-sm text-gray-500">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
        </svg>
        <span>{video.speakers.join(', ')}</span>
      </div>
    )}
  </div>
</div>

{/* Video Modal */}
<div id="video-modal" class="fixed inset-0 z-50 hidden items-center justify-center p-4 bg-black/90">
  <div class="relative w-full max-w-5xl">
    {/* Close Button */}
    <button 
      id="close-modal"
      class="absolute -top-12 right-0 text-white hover:text-gray-300 transition-colors"
      aria-label="Close video"
    >
      <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
    
    {/* Video Container */}
    <div class="aspect-video bg-black rounded-lg overflow-hidden">
      <iframe
        id="video-iframe"
        class="w-full h-full"
        src=""
        title=""
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
        allowfullscreen
      ></iframe>
    </div>
    
    {/* Video Title */}
    <h3 id="modal-title" class="text-white font-heading font-semibold text-xl mt-4"></h3>
  </div>
</div>

<script>
  // Video modal functionality
  document.addEventListener('DOMContentLoaded', () => {
    const modal = document.getElementById('video-modal');
    const iframe = document.getElementById('video-iframe') as HTMLIFrameElement;
    const modalTitle = document.getElementById('modal-title');
    const closeBtn = document.getElementById('close-modal');
    
    // Open modal on video card click
    document.querySelectorAll('.video-card').forEach(card => {
      card.addEventListener('click', () => {
        const embedUrl = card.getAttribute('data-embed-url');
        const title = card.getAttribute('data-video-title');
        
        if (modal && iframe && modalTitle && embedUrl) {
          iframe.src = embedUrl + '&autoplay=1';
          modalTitle.textContent = title || '';
          modal.classList.remove('hidden');
          modal.classList.add('flex');
          document.body.style.overflow = 'hidden';
        }
      });
    });
    
    // Close modal
    const closeModal = () => {
      if (modal && iframe) {
        modal.classList.add('hidden');
        modal.classList.remove('flex');
        iframe.src = '';
        document.body.style.overflow = '';
      }
    };
    
    closeBtn?.addEventListener('click', closeModal);
    modal?.addEventListener('click', (e) => {
      if (e.target === modal) closeModal();
    });
    
    // Close on Escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') closeModal();
    });
  });
</script>

