---
/**
 * Interactive Leaflet map component for Climate Robotics organizations
 */
import type { ClimateRoboticsEntry } from '@/lib/types';
import { ROBOTICS_TYPE_COLORS } from '@/lib/types';

interface Props {
  entries: ClimateRoboticsEntry[];
}

const { entries } = Astro.props;

// Pre-compute filter options
const continents = [...new Set(entries.map(e => e.continentHQ).filter(Boolean))].sort();
const roboticsTypes = [...new Set(entries.map(e => e.roboticsType).filter(Boolean))].sort();
const applications = [...new Set(entries.map(e => e.mainApplication).filter(Boolean))].sort();
const biomes = [...new Set(entries.map(e => e.biomeType).filter(Boolean))].sort();
---

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />

<div class="climate-map-container" id="climate-map-container">
  <!-- Sidebar -->
  <aside class="map-sidebar" id="map-sidebar">
    <div class="sidebar-header">
      <h1 class="sidebar-title">Global Map of Climate Robotics</h1>
      <p class="sidebar-subtitle">
        Exploring <span id="entry-count">{entries.length}</span> organizations worldwide
      </p>
    </div>

    <!-- Search -->
    <div class="sidebar-search">
      <div class="search-input-wrapper">
        <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8" />
          <path d="m21 21-4.35-4.35" />
        </svg>
        <input
          type="text"
          id="map-search"
          placeholder="Search organizations..."
          class="search-input"
        />
      </div>
    </div>

    <!-- Filters -->
    <div class="sidebar-filters">
      <div class="filter-group">
        <label for="filter-continent">Continent</label>
        <select id="filter-continent" class="filter-select">
          <option value="">All Continents</option>
          {continents.map(c => <option value={c}>{c}</option>)}
        </select>
      </div>

      <div class="filter-group">
        <label for="filter-robotics">Robotics Type</label>
        <select id="filter-robotics" class="filter-select">
          <option value="">All Types</option>
          {roboticsTypes.map(r => <option value={r}>{r}</option>)}
        </select>
      </div>

      <div class="filter-group">
        <label for="filter-application">Application</label>
        <select id="filter-application" class="filter-select">
          <option value="">All Applications</option>
          {applications.map(a => <option value={a}>{a}</option>)}
        </select>
      </div>

      <div class="filter-group">
        <label for="filter-biome">Biome</label>
        <select id="filter-biome" class="filter-select">
          <option value="">All Biomes</option>
          {biomes.map(b => <option value={b}>{b}</option>)}
        </select>
      </div>

      <button id="clear-filters" class="clear-filters-btn">
        Clear Filters
      </button>
    </div>

    <!-- Results List -->
    <div class="sidebar-results" id="sidebar-results">
      <!-- Populated by JS -->
    </div>

    <!-- Toggle button for mobile -->
    <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
      <svg class="toggle-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M15 18l-6-6 6-6" />
      </svg>
    </button>
  </aside>

  <!-- Map Container -->
  <div class="map-wrapper" id="map-wrapper">
    <div id="leaflet-map" class="leaflet-map"></div>
    
    <!-- Map attribution overlay -->
    <div class="map-brand">
      Climate Robotics Network
    </div>
  </div>
</div>

<!-- Pass data to client-side script -->
<script define:vars={{ entries, ROBOTICS_TYPE_COLORS }}>
  window.climateMapData = entries;
  window.roboticsTypeColors = ROBOTICS_TYPE_COLORS;
</script>

<script>
  // Load Leaflet scripts dynamically in correct order
  function loadScript(src) {
    return new Promise((resolve, reject) => {
      const script = document.createElement('script');
      script.src = src;
      script.crossOrigin = '';
      script.onload = resolve;
      script.onerror = reject;
      document.head.appendChild(script);
    });
  }
  
  async function loadLeaflet() {
    try {
      await loadScript('https://unpkg.com/leaflet@1.9.4/dist/leaflet.js');
      await loadScript('https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js');
      initMap();
    } catch (error) {
      console.error('Failed to load Leaflet:', error);
    }
  }
  
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', loadLeaflet);
  } else {
    loadLeaflet();
  }
  
  function initMap() {
    const entries = window.climateMapData || [];
    const typeColors = window.roboticsTypeColors || {};
    
    // Initialize map with muted style
    const map = L.map('leaflet-map', {
      center: [20, 0],
      zoom: 2,
      minZoom: 2,
      maxZoom: 18,
      zoomControl: false,
    });
    
    // Add zoom control to top-right
    L.control.zoom({ position: 'topright' }).addTo(map);
    
    // CartoDB Positron (muted grayscale style)
    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="https://carto.com/attributions">CARTO</a>',
      subdomains: 'abcd',
      maxZoom: 20
    }).addTo(map);
    
    // Create marker cluster group
    const markers = L.markerClusterGroup({
      chunkedLoading: true,
      spiderfyOnMaxZoom: true,
      showCoverageOnHover: false,
      zoomToBoundsOnClick: true,
      maxClusterRadius: 50,
      iconCreateFunction: function(cluster) {
        const count = cluster.getChildCount();
        let size = 'small';
        if (count > 50) size = 'large';
        else if (count > 10) size = 'medium';
        
        return L.divIcon({
          html: `<div class="cluster-marker cluster-${size}"><span>${count}</span></div>`,
          className: 'marker-cluster-custom',
          iconSize: L.point(40, 40)
        });
      }
    });
    
    // Store markers by ID for filtering
    const markerMap = new Map();
    
    // Create markers for each entry
    entries.forEach(entry => {
      if (!entry.coordinates) return;
      
      const [lat, lng] = entry.coordinates;
      const color = typeColors[entry.roboticsType] || '#6b7280';
      
      // Create custom icon with logo or colored circle
      const icon = L.divIcon({
        html: entry.logoUrl 
          ? `<div class="logo-marker" style="border-color: ${color}">
               <img src="${entry.logoUrl}" alt="${entry.name}" onerror="this.style.display='none'; this.parentElement.classList.add('fallback')" />
             </div>`
          : `<div class="dot-marker" style="background-color: ${color}"></div>`,
        className: 'custom-marker',
        iconSize: [36, 36],
        iconAnchor: [18, 18],
        popupAnchor: [0, -18]
      });
      
      const marker = L.marker([lat, lng], { icon });
      
      // Create popup content
      const websiteLink = entry.website 
        ? `<a href="${entry.website.startsWith('http') ? entry.website : 'https://' + entry.website}" target="_blank" rel="noopener" class="popup-link">Visit Website →</a>`
        : '';
      
      const linkedInLink = entry.linkedIn
        ? `<a href="${entry.linkedIn}" target="_blank" rel="noopener" class="popup-linkedin">LinkedIn</a>`
        : '';
      
      marker.bindPopup(`
        <div class="map-popup">
          <div class="popup-header">
            ${entry.logoUrl ? `<img src="${entry.logoUrl}" alt="" class="popup-logo" />` : ''}
            <div>
              <h3 class="popup-title">${entry.name}</h3>
              <p class="popup-location">${entry.countryHQ}${entry.continentHQ ? ` • ${entry.continentHQ}` : ''}</p>
            </div>
          </div>
          ${entry.description ? `<p class="popup-description">${entry.description}</p>` : ''}
          <div class="popup-tags">
            ${entry.roboticsType ? `<span class="popup-tag" style="background-color: ${color}20; color: ${color}">${entry.roboticsType}</span>` : ''}
            ${entry.mainApplication ? `<span class="popup-tag">${entry.mainApplication}</span>` : ''}
            ${entry.biomeType ? `<span class="popup-tag">${entry.biomeType}</span>` : ''}
          </div>
          <div class="popup-actions">
            ${websiteLink}
            ${linkedInLink}
          </div>
        </div>
      `, {
        maxWidth: 320,
        className: 'custom-popup'
      });
      
      markerMap.set(entry.id, { marker, entry });
      markers.addLayer(marker);
    });
    
    map.addLayer(markers);
    
    // Fit bounds to show all markers
    if (entries.length > 0) {
      const validEntries = entries.filter(e => e.coordinates);
      if (validEntries.length > 0) {
        const bounds = L.latLngBounds(validEntries.map(e => e.coordinates));
        map.fitBounds(bounds, { padding: [50, 50] });
      }
    }
    
    // Filter functionality
    const searchInput = document.getElementById('map-search');
    const continentFilter = document.getElementById('filter-continent');
    const roboticsFilter = document.getElementById('filter-robotics');
    const applicationFilter = document.getElementById('filter-application');
    const biomeFilter = document.getElementById('filter-biome');
    const clearFiltersBtn = document.getElementById('clear-filters');
    const resultsContainer = document.getElementById('sidebar-results');
    const entryCountEl = document.getElementById('entry-count');
    
    function applyFilters() {
      const search = searchInput?.value?.toLowerCase() || '';
      const continent = continentFilter?.value || '';
      const roboticsType = roboticsFilter?.value || '';
      const application = applicationFilter?.value || '';
      const biome = biomeFilter?.value || '';
      
      markers.clearLayers();
      let visibleCount = 0;
      const visibleEntries = [];
      
      markerMap.forEach(({ marker, entry }) => {
        let visible = true;
        
        // Search filter
        if (search) {
          const matchesSearch = 
            entry.name.toLowerCase().includes(search) ||
            entry.description?.toLowerCase().includes(search) ||
            entry.countryHQ?.toLowerCase().includes(search);
          if (!matchesSearch) visible = false;
        }
        
        // Other filters
        if (visible && continent && entry.continentHQ !== continent) visible = false;
        if (visible && roboticsType && entry.roboticsType !== roboticsType) visible = false;
        if (visible && application && entry.mainApplication !== application) visible = false;
        if (visible && biome && entry.biomeType !== biome) visible = false;
        
        if (visible) {
          markers.addLayer(marker);
          visibleCount++;
          visibleEntries.push(entry);
        }
      });
      
      // Update count
      if (entryCountEl) {
        entryCountEl.textContent = visibleCount.toString();
      }
      
      // Update results list
      renderResultsList(visibleEntries);
    }
    
    function renderResultsList(entries) {
      if (!resultsContainer) return;
      
      if (entries.length === 0) {
        resultsContainer.innerHTML = '<p class="no-results">No organizations match your filters.</p>';
        return;
      }
      
      // Limit to first 100 for performance
      const displayEntries = entries.slice(0, 100);
      
      resultsContainer.innerHTML = displayEntries.map(entry => {
        const color = typeColors[entry.roboticsType] || '#6b7280';
        return `
          <button class="result-card" data-id="${entry.id}">
            <div class="result-logo" style="border-color: ${color}">
              ${entry.logoUrl 
                ? `<img src="${entry.logoUrl}" alt="" onerror="this.style.display='none'" />`
                : `<div class="result-logo-fallback" style="background-color: ${color}"></div>`
              }
            </div>
            <div class="result-info">
              <h4 class="result-name">${entry.name}</h4>
              <p class="result-location">${entry.countryHQ || 'Unknown'}</p>
              ${entry.mainApplication ? `<span class="result-tag">${entry.mainApplication}</span>` : ''}
            </div>
          </button>
        `;
      }).join('');
      
      if (entries.length > 100) {
        resultsContainer.innerHTML += `<p class="results-overflow">Showing 100 of ${entries.length} results</p>`;
      }
      
      // Add click handlers
      resultsContainer.querySelectorAll('.result-card').forEach(card => {
        card.addEventListener('click', () => {
          const id = card.dataset.id;
          const data = markerMap.get(id);
          if (data) {
            const { marker, entry } = data;
            map.setView(entry.coordinates, 10, { animate: true });
            marker.openPopup();
          }
        });
      });
    }
    
    // Event listeners
    searchInput?.addEventListener('input', debounce(applyFilters, 300));
    continentFilter?.addEventListener('change', applyFilters);
    roboticsFilter?.addEventListener('change', applyFilters);
    applicationFilter?.addEventListener('change', applyFilters);
    biomeFilter?.addEventListener('change', applyFilters);
    
    clearFiltersBtn?.addEventListener('click', () => {
      if (searchInput) searchInput.value = '';
      if (continentFilter) continentFilter.value = '';
      if (roboticsFilter) roboticsFilter.value = '';
      if (applicationFilter) applicationFilter.value = '';
      if (biomeFilter) biomeFilter.value = '';
      applyFilters();
    });
    
    // Sidebar toggle for mobile
    const sidebar = document.getElementById('map-sidebar');
    const sidebarToggle = document.getElementById('sidebar-toggle');
    
    sidebarToggle?.addEventListener('click', () => {
      sidebar?.classList.toggle('collapsed');
    });
    
    // Initial render
    renderResultsList(entries);
    
    // Debounce helper
    function debounce(fn, delay) {
      let timeout;
      return function(...args) {
        clearTimeout(timeout);
        timeout = setTimeout(() => fn.apply(this, args), delay);
      };
    }
  }
</script>

<style>
  /* Container */
  .climate-map-container {
    position: relative;
    display: flex;
    width: 100%;
    height: 100vh;
    overflow: hidden;
    background: #f8fafc;
  }
  
  /* Sidebar */
  .map-sidebar {
    position: relative;
    z-index: 1000;
    width: 380px;
    min-width: 380px;
    max-width: 380px;
    height: 100%;
    background: white;
    box-shadow: 4px 0 24px rgba(0, 0, 0, 0.08);
    display: flex;
    flex-direction: column;
    transition: transform 0.3s ease, margin-left 0.3s ease;
    overflow: hidden;
  }
  
  .map-sidebar.collapsed {
    margin-left: -380px;
  }
  
  .sidebar-header {
    padding: 1.5rem;
    border-bottom: 1px solid #e5e7eb;
    background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
    color: white;
  }
  
  .sidebar-title {
    font-family: 'Oswald', system-ui, sans-serif;
    font-size: 1.25rem;
    font-weight: 600;
    letter-spacing: 0.05em;
    text-transform: uppercase;
    margin: 0 0 0.25rem 0;
  }
  
  .sidebar-subtitle {
    font-size: 0.875rem;
    opacity: 0.9;
    margin: 0;
  }
  
  /* Search */
  .sidebar-search {
    padding: 1rem 1.5rem;
    border-bottom: 1px solid #e5e7eb;
  }
  
  .search-input-wrapper {
    position: relative;
  }
  
  .search-icon {
    position: absolute;
    left: 12px;
    top: 50%;
    transform: translateY(-50%);
    width: 18px;
    height: 18px;
    color: #9ca3af;
    pointer-events: none;
  }
  
  .search-input {
    width: 100%;
    padding: 0.75rem 1rem 0.75rem 2.75rem;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    font-size: 0.9375rem;
    transition: border-color 0.2s, box-shadow 0.2s;
    background: #f9fafb;
  }
  
  .search-input:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    background: white;
  }
  
  .search-input::placeholder {
    color: #9ca3af;
  }
  
  /* Filters */
  .sidebar-filters {
    padding: 1rem 1.5rem;
    border-bottom: 1px solid #e5e7eb;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0.75rem;
    overflow: hidden;
  }
  
  .filter-group {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
    min-width: 0;
  }
  
  .filter-group label {
    font-size: 0.75rem;
    font-weight: 500;
    color: #6b7280;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }
  
  .filter-select {
    width: 100%;
    max-width: 100%;
    padding: 0.5rem 0.75rem;
    border: 1px solid #e5e7eb;
    border-radius: 6px;
    font-size: 0.875rem;
    background: white;
    cursor: pointer;
    transition: border-color 0.2s;
    box-sizing: border-box;
  }
  
  .filter-select:focus {
    outline: none;
    border-color: #3b82f6;
  }
  
  .clear-filters-btn {
    grid-column: 1 / -1;
    padding: 0.5rem 1rem;
    background: #f3f4f6;
    border: 1px solid #e5e7eb;
    border-radius: 6px;
    font-size: 0.8125rem;
    font-weight: 500;
    color: #6b7280;
    cursor: pointer;
    transition: all 0.2s;
  }
  
  .clear-filters-btn:hover {
    background: #e5e7eb;
    color: #374151;
  }
  
  /* Results List */
  .sidebar-results {
    flex: 1;
    overflow-y: auto;
    padding: 0.5rem;
  }
  
  .result-card {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    width: 100%;
    padding: 0.75rem;
    background: white;
    border: 1px solid transparent;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s;
    text-align: left;
  }
  
  .result-card:hover {
    background: #f8fafc;
    border-color: #e5e7eb;
  }
  
  .result-logo {
    width: 40px;
    height: 40px;
    min-width: 40px;
    border-radius: 8px;
    border: 2px solid #e5e7eb;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    background: white;
  }
  
  .result-logo img {
    width: 28px;
    height: 28px;
    object-fit: contain;
  }
  
  .result-logo-fallback {
    width: 16px;
    height: 16px;
    border-radius: 50%;
  }
  
  .result-info {
    flex: 1;
    min-width: 0;
  }
  
  .result-name {
    font-size: 0.9375rem;
    font-weight: 600;
    color: #1f2937;
    margin: 0 0 0.125rem 0;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  
  .result-location {
    font-size: 0.8125rem;
    color: #6b7280;
    margin: 0 0 0.25rem 0;
  }
  
  .result-tag {
    display: inline-block;
    padding: 0.125rem 0.5rem;
    background: #f3f4f6;
    border-radius: 4px;
    font-size: 0.6875rem;
    color: #6b7280;
    text-transform: uppercase;
    letter-spacing: 0.025em;
  }
  
  .no-results {
    padding: 2rem;
    text-align: center;
    color: #9ca3af;
    font-size: 0.9375rem;
  }
  
  .results-overflow {
    padding: 0.75rem;
    text-align: center;
    color: #9ca3af;
    font-size: 0.8125rem;
    border-top: 1px solid #e5e7eb;
    margin-top: 0.5rem;
  }
  
  /* Sidebar Toggle */
  .sidebar-toggle {
    position: absolute;
    right: -44px;
    top: 50%;
    transform: translateY(-50%);
    width: 44px;
    height: 80px;
    background: white;
    border: none;
    border-radius: 0 8px 8px 0;
    box-shadow: 4px 0 12px rgba(0, 0, 0, 0.1);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.2s;
  }
  
  .sidebar-toggle:hover {
    background: #f8fafc;
  }
  
  .toggle-icon {
    width: 24px;
    height: 24px;
    color: #6b7280;
    transition: transform 0.3s;
  }
  
  .map-sidebar.collapsed .toggle-icon {
    transform: rotate(180deg);
  }
  
  /* Map */
  .map-wrapper {
    flex: 1;
    position: relative;
    overflow: hidden;
  }
  
  .leaflet-map {
    width: 100%;
    height: 100%;
  }
  
  .map-brand {
    position: absolute;
    bottom: 24px;
    right: 10px;
    z-index: 1000;
    padding: 0.375rem 0.75rem;
    background: rgba(255, 255, 255, 0.95);
    border-radius: 4px;
    font-family: 'Oswald', system-ui, sans-serif;
    font-size: 0.75rem;
    font-weight: 500;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: #1e40af;
    box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
  }
  
  /* Custom Markers */
  :global(.custom-marker) {
    background: transparent !important;
    border: none !important;
  }
  
  :global(.logo-marker) {
    width: 36px;
    height: 36px;
    border-radius: 8px;
    border: 2px solid #3b82f6;
    background: white;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    overflow: hidden;
    transition: transform 0.2s, box-shadow 0.2s;
  }
  
  :global(.logo-marker:hover) {
    transform: scale(1.1);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  }
  
  :global(.logo-marker img) {
    width: 24px;
    height: 24px;
    object-fit: contain;
  }
  
  :global(.logo-marker.fallback) {
    background: linear-gradient(135deg, #3b82f6, #1e40af);
  }
  
  :global(.dot-marker) {
    width: 14px;
    height: 14px;
    border-radius: 50%;
    border: 2px solid white;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
    margin: 11px;
    transition: transform 0.2s;
  }
  
  :global(.dot-marker:hover) {
    transform: scale(1.3);
  }
  
  /* Cluster Markers */
  :global(.marker-cluster-custom) {
    background: transparent !important;
  }
  
  :global(.cluster-marker) {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Source Sans 3', system-ui, sans-serif;
    font-weight: 600;
    font-size: 0.875rem;
    box-shadow: 0 3px 12px rgba(30, 64, 175, 0.4);
    border: 3px solid white;
    transition: transform 0.2s;
  }
  
  :global(.cluster-marker:hover) {
    transform: scale(1.1);
  }
  
  :global(.cluster-medium) {
    width: 48px;
    height: 48px;
    font-size: 1rem;
  }
  
  :global(.cluster-large) {
    width: 56px;
    height: 56px;
    font-size: 1.125rem;
  }
  
  /* Custom Popup */
  :global(.custom-popup .leaflet-popup-content-wrapper) {
    border-radius: 12px;
    padding: 0;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
  }
  
  :global(.custom-popup .leaflet-popup-content) {
    margin: 0;
    width: auto !important;
  }
  
  :global(.custom-popup .leaflet-popup-tip) {
    box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
  }
  
  :global(.map-popup) {
    padding: 1rem;
    min-width: 260px;
    max-width: 320px;
  }
  
  :global(.popup-header) {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    margin-bottom: 0.75rem;
  }
  
  :global(.popup-logo) {
    width: 40px;
    height: 40px;
    border-radius: 8px;
    object-fit: contain;
    background: #f9fafb;
    border: 1px solid #e5e7eb;
  }
  
  :global(.popup-title) {
    font-family: 'Oswald', system-ui, sans-serif;
    font-size: 1.125rem;
    font-weight: 600;
    color: #1f2937;
    margin: 0;
    line-height: 1.2;
  }
  
  :global(.popup-location) {
    font-size: 0.8125rem;
    color: #6b7280;
    margin: 0.125rem 0 0 0;
  }
  
  :global(.popup-description) {
    font-size: 0.875rem;
    color: #4b5563;
    line-height: 1.5;
    margin: 0 0 0.75rem 0;
  }
  
  :global(.popup-tags) {
    display: flex;
    flex-wrap: wrap;
    gap: 0.375rem;
    margin-bottom: 0.75rem;
  }
  
  :global(.popup-tag) {
    display: inline-block;
    padding: 0.25rem 0.5rem;
    background: #f3f4f6;
    border-radius: 4px;
    font-size: 0.6875rem;
    color: #6b7280;
    text-transform: uppercase;
    letter-spacing: 0.025em;
  }
  
  :global(.popup-actions) {
    display: flex;
    gap: 0.75rem;
    padding-top: 0.75rem;
    border-top: 1px solid #e5e7eb;
  }
  
  :global(.popup-link) {
    font-size: 0.8125rem;
    font-weight: 600;
    color: #1e40af;
    text-decoration: none;
    transition: color 0.2s;
  }
  
  :global(.popup-link:hover) {
    color: #3b82f6;
  }
  
  :global(.popup-linkedin) {
    font-size: 0.8125rem;
    color: #6b7280;
    text-decoration: none;
    transition: color 0.2s;
  }
  
  :global(.popup-linkedin:hover) {
    color: #0077b5;
  }
  
  /* Mobile Responsive */
  @media (max-width: 768px) {
    .map-sidebar {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      max-width: 340px;
      height: 100%;
    }
    
    .map-sidebar.collapsed {
      margin-left: -340px;
    }
    
    .sidebar-toggle {
      right: -40px;
    }
    
    .sidebar-filters {
      grid-template-columns: 1fr;
    }
  }
</style>

