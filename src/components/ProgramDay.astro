---
/**
 * ProgramDay Component
 * Collapsible day section showing sessions with embedded video cards.
 */
import type { ProgramDay } from '@/lib/summits-data';
import VideoCard from './VideoCard.astro';

interface Props {
  programDay: ProgramDay;
  defaultOpen?: boolean;
}

const { programDay, defaultOpen = false } = Astro.props;

const dayColors = ['from-crn-blue', 'from-teal-500', 'from-orange-500', 'from-purple-500'];
const gradientClass = dayColors[(programDay.day - 1) % dayColors.length];
---

<div class="program-day border border-gray-200 rounded-xl overflow-hidden bg-white shadow-sm">
  {/* Day Header (Collapsible) */}
  <button
    class="w-full program-day-toggle flex items-center justify-between p-6 hover:bg-gray-50 transition-colors text-left"
    aria-expanded={defaultOpen ? 'true' : 'false'}
    data-day={programDay.day}
  >
    <div class="flex items-center gap-4">
      {/* Day Badge */}
      <div class={`w-16 h-16 rounded-xl bg-gradient-to-br ${gradientClass} to-gray-900 flex flex-col items-center justify-center text-white shadow-lg`}>
        <span class="text-xs uppercase tracking-wide font-medium">Day</span>
        <span class="text-2xl font-heading font-bold">{programDay.day}</span>
      </div>
      
      <div>
        <h3 class="text-xl font-heading font-semibold text-gray-900">
          {programDay.theme}
        </h3>
        <p class="text-gray-500 text-sm">
          {programDay.date} â€¢ {programDay.sessions.length} Sessions
        </p>
      </div>
    </div>
    
    {/* Expand/Collapse Icon */}
    <div class="flex items-center gap-4">
      <span class="text-sm text-gray-500 hidden sm:block">
        {programDay.sessions.reduce((acc, s) => acc + s.videos.length, 0)} Videos
      </span>
      <svg 
        class="w-6 h-6 text-gray-400 transition-transform duration-300 program-day-icon"
        fill="none" 
        stroke="currentColor" 
        viewBox="0 0 24 24"
      >
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
      </svg>
    </div>
  </button>
  
  {/* Collapsible Content */}
  <div 
    class={`program-day-content overflow-hidden transition-all duration-500 ${defaultOpen ? 'max-h-[5000px]' : 'max-h-0'}`}
    data-default-open={defaultOpen}
  >
    <div class="border-t border-gray-200">
      {programDay.sessions.map((session, idx) => (
        <div class={`${idx > 0 ? 'border-t border-gray-100' : ''}`}>
          {/* Session Header */}
          <div class="px-6 py-4 bg-gray-50">
            <div class="flex items-start justify-between gap-4">
              <div>
                <h4 class="font-heading font-semibold text-gray-900">
                  {session.title}
                </h4>
                {session.description && (
                  <p class="text-gray-600 text-sm mt-1">{session.description}</p>
                )}
              </div>
              <span class="text-sm text-crn-blue font-medium whitespace-nowrap">
                {session.time}
              </span>
            </div>
          </div>
          
          {/* Session Videos */}
          {session.videos.length > 0 && (
            <div class="p-6 grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
              {session.videos.map(video => (
                <VideoCard video={video} compact />
              ))}
            </div>
          )}
        </div>
      ))}
    </div>
  </div>
</div>

<script>
  // Collapsible day functionality
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.program-day-toggle').forEach(toggle => {
      toggle.addEventListener('click', () => {
        const content = toggle.nextElementSibling as HTMLElement;
        const icon = toggle.querySelector('.program-day-icon') as HTMLElement;
        const isExpanded = toggle.getAttribute('aria-expanded') === 'true';
        
        if (isExpanded) {
          content.style.maxHeight = '0';
          toggle.setAttribute('aria-expanded', 'false');
          icon.style.transform = 'rotate(0deg)';
        } else {
          content.style.maxHeight = content.scrollHeight + 'px';
          toggle.setAttribute('aria-expanded', 'true');
          icon.style.transform = 'rotate(180deg)';
        }
      });
    });
    
    // Initialize open states
    document.querySelectorAll('.program-day-content[data-default-open="true"]').forEach(content => {
      const toggle = content.previousElementSibling as HTMLElement;
      const icon = toggle?.querySelector('.program-day-icon') as HTMLElement;
      if (icon) icon.style.transform = 'rotate(180deg)';
    });
  });
</script>

<style>
  .program-day-content {
    will-change: max-height;
  }
</style>

